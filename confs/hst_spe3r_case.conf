general {
    # Ogni CASE_NAME avrà la sua exp dir separata, es: exp/hst_neus_1views/wmask
    base_exp_dir = ./exp/hst_neus_CASE_NAME/wmask
    recording = [
        ./,
        ./models
    ]
}

dataset {
    # Usa le tre cartelle con symlink nella repo NeuS:
    # NeuS/preliminary_analysis_data/hst_neus_1views
    # NeuS/preliminary_analysis_data/hst_neus_4views
    # NeuS/preliminary_analysis_data/hst_neus_8views
    data_dir = ./preliminary_analysis_data/hst_neus_CASE_NAME/

    # Nome del file delle camere che hai nelle cartelle hst_neus_Xviews
    render_cameras_name = cameras_spe3r.npz
    object_cameras_name = cameras_spe3r.npz
}


# Setting for rapid testing and debugging

train {
    learning_rate = 5e-4
    learning_rate_alpha = 0.05

    # --- SOLO PER SMOKE TEST ---
    end_iter = 200          # invece di 20000
    batch_size = 256        # opzionale: leggermente più leggero su CPU
    warm_up_end = 100       # deve stare < end_iter, tanto è solo un test
    anneal_end = 0
    use_white_bkgd = False

    # fai in modo che tutto cada a fine test
    save_freq = 200
    val_freq = 200
    val_mesh_freq = 200
    report_freq = 20        # logga un po' più spesso all'inizio

    igr_weight = 0.1
    mask_weight = 0.1
}

model {
    nerf {
        D = 8,
        d_in = 4,
        d_in_view = 3,
        W = 256,
        multires = 10,
        multires_view = 4,
        output_ch = 4,
        skips=[4],
        use_viewdirs=True
    }

    sdf_network {
        d_out = 257
        d_in = 3
        d_hidden = 256
        n_layers = 8
        skip_in = [4]
        multires = 6
        bias = 0.5
        scale = 1.0
        geometric_init = True
        weight_norm = True
    }

    variance_network {
        init_val = 0.3
    }

    rendering_network {
        d_feature = 256
        mode = idr
        d_in = 9
        d_out = 3
        d_hidden = 256
        n_layers = 4
        weight_norm = True
        multires_view = 4
        squeeze_out = True
    }

    neus_renderer {
        n_samples = 32       # invece di 64
        n_importance = 32    # invece di 64
        n_outside = 0
        up_sample_steps = 2  # invece di 4
        perturb = 1.0
    }
}


# Settup for training NeuS on HST SPE3R dataset
# train {
#     learning_rate = 5e-4
#     learning_rate_alpha = 0.05

#     # Per analisi preliminare tienilo basso (CPU / Colab):
#     end_iter = 20000

#     batch_size = 512
#     validate_resolution_level = 4
#     warm_up_end = 5000
#     anneal_end = 0
#     use_white_bkgd = False

#     save_freq = 5000
#     val_freq = 2500
#     val_mesh_freq = 5000
#     report_freq = 100

#     igr_weight = 0.1
#     mask_weight = 0.1
# }

# model {
#     nerf {
#         D = 8,
#         d_in = 4,
#         d_in_view = 3,
#         W = 256,
#         multires = 10,
#         multires_view = 4,
#         output_ch = 4,
#         skips=[4],
#         use_viewdirs=True
#     }

#     sdf_network {
#         d_out = 257
#         d_in = 3
#         d_hidden = 256
#         n_layers = 8
#         skip_in = [4]
#         multires = 6
#         bias = 0.5
#         scale = 1.0
#         geometric_init = True
#         weight_norm = True
#     }

#     variance_network {
#         init_val = 0.3
#     }

#     rendering_network {
#         d_feature = 256
#         mode = idr
#         d_in = 9
#         d_out = 3
#         d_hidden = 256
#         n_layers = 4
#         weight_norm = True
#         multires_view = 4
#         squeeze_out = True
#     }

#     neus_renderer {
#         n_samples = 64
#         n_importance = 64
#         n_outside = 0
#         up_sample_steps = 4     # 1 for simple coarse-to-fine sampling
#         perturb = 1.0
#     }
# }
  